
#Adding IIS and PHP Modules

##Install IIS
Install-WindowsFeature web-server

##Add Security Features
Install-WindowsFeature Web-Basic-Auth
Install-WindowsFeature Web-CertProvider
Install-WindowsFeature Web-Client-Auth 
Install-WindowsFeature Web-Digest-Auth 
Install-WindowsFeature Web-Cert-Auth   
Install-WindowsFeature Web-IP-Security 
Install-WindowsFeature Web-Url-Auth    
Install-WindowsFeature Web-Windows-Auth

##Add Application Development Features
Install-WindowsFeature Web-App-Dev
Install-WindowsFeature Web-CGI


##Add Management Tools
Install-WindowsFeature Web-Mgmt-Console     
Install-WindowsFeature Web-Mgmt-Compat      
Install-WindowsFeature Web-Metabase         
Install-WindowsFeature Web-Lgcy-Mgmt-Console
Install-WindowsFeature Web-Lgcy-Scripting   
Install-WindowsFeature Web-WMI              
Install-WindowsFeature Web-Scripting-Tools  
Install-WindowsFeature Web-Mgmt-Service     

#Note: 'Get-WindowsFeature' used to list out all instaleld features
#---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x
#Allow http Port 80 inbound in Windows Firewall (Not Mandatory)
Enable-NetFirewallRule -DisplayName "BranchCache Content Retrieval (HTTP-In)"
Enable-NetFirewallRule -DisplayName "BranchCache Hosted Cache Server (HTTP-In)"
#---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x

#Download, Unzip and Install VC++ 2015-2019
$url = "https://raw.githubusercontent.com/vpjaseem/Cloud-Computing/main/Azure/Downloads/VC_Redistributable_2015_2019.zip"
$output = "$home\Downloads\VC_Redistributable_2015_2019.zip"
$start_time = Get-Date
Invoke-WebRequest -Uri $url -OutFile $output
Write-Output "Time taken: $((Get-Date).Subtract($start_time).Seconds) second(s)"
Expand-Archive -LiteralPath $home\Downloads\VC_Redistributable_2015_2019.zip -DestinationPath $home\Downloads\VC_Redistributable_2015_2019_Extracted
.$home\Downloads\VC_Redistributable_2015_2019_Extracted\VC_Redistributable_2015_2019.exe /quiet
#---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x

#Download, Unzip PHP 7.4
$url = "https://github.com/vpjaseem/Cloud-Computing/raw/main/Azure/Downloads/php-7.4.13-nts-Win32-VC15-x64.zip"
$output = "$home\Downloads\php-7-4.zip"
$start_time = Get-Date
Invoke-WebRequest -Uri $url -OutFile $output
Write-Output "Time taken: $((Get-Date).Subtract($start_time).Seconds) second(s)"
Expand-Archive -LiteralPath $home\Downloads\php-7-4.zip -DestinationPath 'C:\Program Files\iis express\PHP\v7.4'
#---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x---x

